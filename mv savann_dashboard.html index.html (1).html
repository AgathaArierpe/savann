<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Savann - Sistema de Gest√£o</title>
    
    <!-- Google APIs -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://apis.google.com/js/client.js?onload=initClient" async defer></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(90deg, #1a1a2e 0%, #0f3460 100%);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .logo {
            font-size: 2.5em;
            font-weight: bold;
            color: #ff6b35;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .subtitle {
            color: #b8c6db;
            margin-top: 5px;
            font-size: 1.1em;
        }

        .auth-section {
            background: rgba(66, 165, 245, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px;
            border: 1px solid rgba(66, 165, 245, 0.3);
        }

        .config-section {
            background: rgba(255, 107, 53, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px;
            border: 1px solid rgba(255, 107, 53, 0.3);
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            gap: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .tab-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .tab-button.active {
            background: linear-gradient(45deg, #f7931e, #ff6b35);
            transform: translateY(-2px);
        }

        .tab-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .tab-content {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .card h2 {
            color: #ff6b35;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .expense-item, .investment-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ff6b35;
            margin: 10px 0;
            position: relative;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            color: #b8c6db;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        .input-group input::placeholder, .input-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .btn {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-google {
            background: linear-gradient(45deg, #4285f4, #34a853);
            box-shadow: 0 4px 15px rgba(66, 133, 244, 0.3);
        }

        .btn-google:hover {
            box-shadow: 0 6px 20px rgba(66, 133, 244, 0.4);
        }

        .btn-small {
            padding: 5px 15px;
            font-size: 12px;
            margin: 5px;
        }

        .summary-box {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
        }

        .summary-box h3 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .client-plan {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            border: 1px solid rgba(255, 107, 53, 0.3);
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .status-ativo { background: #4CAF50; }
        .status-pausado { background: #FF9800; }
        .status-cancelado { background: #F44336; }

        .metric {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b35;
        }

        .metric-label {
            color: #b8c6db;
            font-size: 0.9em;
        }

        .success-message {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }

        .error-message {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            z-index: 1000;
        }

        .status-connected {
            background: rgba(76, 175, 80, 0.9);
            color: white;
        }

        .status-disconnected {
            background: rgba(244, 67, 54, 0.9);
            color: white;
        }

        .status-authenticated {
            background: rgba(66, 165, 245, 0.9);
            color: white;
        }

        .user-info {
            background: rgba(66, 165, 245, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            vertical-align: middle;
            margin-right: 10px;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .tab-button {
                width: 80%;
                margin: 5px 0;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">Savann</div>
        <div class="subtitle">Sistema de Gest√£o - Conectado ao Google Sheets com OAuth</div>
    </div>

    <div id="connectionStatus" class="connection-status status-disconnected">
        üî¥ N√£o Autenticado
    </div>

    <!-- Se√ß√£o de Autentica√ß√£o Google -->
    <div class="auth-section">
        <h3>üîê Autentica√ß√£o Google</h3>
        <p style="color: #b8c6db;">Fa√ßa login com sua conta Google para acessar e gerenciar suas planilhas de forma segura.</p>
        
        <div class="grid">
            <div>
                <button class="btn btn-google" onclick="handleAuthClick()" id="signInBtn" disabled>
                    üîê Fazer Login com Google
                </button>
                <button class="btn" onclick="handleSignoutClick()" id="signOutBtn" disabled>
                    üö™ Logout do Google
                </button>
                
                <div class="user-info" id="userInfo">
                    <h4>üë§ Usu√°rio Autenticado</h4>
                    <div id="userDetails"></div>
                </div>
            </div>
            <div>
                <p style="color: #b8c6db; font-size: 14px;">
                    <strong>‚úÖ Vantagens do Login OAuth:</strong><br>
                    ‚Ä¢ Sem problemas de CORS<br>
                    ‚Ä¢ Acesso total √†s suas planilhas<br>
                    ‚Ä¢ Seguran√ßa m√°xima do Google<br>
                    ‚Ä¢ Sem limita√ß√µes de API
                </p>
            </div>
        </div>
    </div>

    <!-- Se√ß√£o de Configura√ß√£o -->
    <div class="config-section">
        <h3>üìä Configura√ß√£o da Planilha</h3>
        <div class="grid">
            <div class="input-group">
                <label>ID da Planilha Google Sheets</label>
                <input type="text" id="spreadsheetId" value="1ybPKiw96ah1ufGXWh853Y0HdK0TEmztvZxg5W8dh2fQ" placeholder="Cole o ID da sua planilha aqui">
                <small style="color: #b8c6db;">J√° configurado com sua planilha</small>
            </div>
            <button class="btn" onclick="verificarPlanilha()" id="verifyBtn" disabled>üß™ Verificar Planilha</button>
            <button class="btn" onclick="carregarDados()" id="loadBtn" disabled>üì• Carregar Dados da Planilha</button>
        </div>
        <div id="configMessages"></div>
    </div>

    <div class="nav-tabs">
        <button class="tab-button active" onclick="mostrarAba('gastos')" id="tabGastos" disabled>üí∞ Gastos</button>
        <button class="tab-button" onclick="mostrarAba('investimentos')" id="tabInvestimentos" disabled>üìà Investimentos</button>
        <button class="tab-button" onclick="mostrarAba('clientes')" id="tabClientes" disabled>üë• Clientes</button>
        <button class="tab-button" onclick="mostrarAba('dashboard')" id="tabDashboard" disabled>üìä Dashboard</button>
        <button class="tab-button" onclick="mostrarAba('ajuda')" id="tabAjuda">‚ùì Ajuda</button>
    </div>

    <!-- ABA GASTOS -->
    <div id="gastos" class="tab-content active">
        <div class="card">
            <h2>üí∞ Controle de Gastos</h2>
            
            <div class="grid">
                <div>
                    <h3>Adicionar Novo Gasto</h3>
                    <div class="input-group">
                        <label>Descri√ß√£o do Gasto</label>
                        <input type="text" id="gastoDescricao" placeholder="Ex: Licen√ßa Adobe Creative Suite">
                    </div>
                    <div class="input-group">
                        <label>Categoria</label>
                        <select id="gastoCategoria">
                            <option value="Software">Software/Ferramentas</option>
                            <option value="Marketing">Marketing/Publicidade</option>
                            <option value="Pessoal">Pessoal</option>
                            <option value="Operacional">Operacional</option>
                            <option value="Infraestrutura">Infraestrutura</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Valor (R$)</label>
                        <input type="number" id="gastoValor" placeholder="0,00" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>Recorr√™ncia</label>
                        <select id="gastoRecorrencia">
                            <option value="√önico">√önico</option>
                            <option value="Mensal">Mensal</option>
                            <option value="Anual">Anual</option>
                        </select>
                    </div>
                    <button class="btn" onclick="adicionarGasto()" id="addGastoBtn" disabled>üíæ Adicionar Gasto</button>
                    <div id="gastoSucesso" class="success-message">Gasto adicionado e salvo no Google Sheets!</div>
                    <div id="gastoErro" class="error-message">Erro ao salvar gasto. Verifique a conex√£o.</div>
                </div>

                <div>
                    <h3>Resumo Mensal</h3>
                    <div class="summary-box">
                        <h3 id="totalGastos">R$ 0,00</h3>
                        <p>Total de Gastos do M√™s</p>
                    </div>
                    
                    <div class="grid">
                        <div class="metric">
                            <div class="metric-value" id="gastosSoftware">R$ 0</div>
                            <div class="metric-label">Software</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="gastosMarketing">R$ 0</div>
                            <div class="metric-label">Marketing</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="listaGastos">
                <h3>Gastos Registrados</h3>
                <p style="color: #b8c6db;">Fa√ßa login com Google para ver os dados.</p>
            </div>
        </div>
    </div>

    <!-- ABA CLIENTES -->
    <div id="clientes" class="tab-content">
        <div class="card">
            <h2>üë• Planos de Cliente</h2>
            
            <div class="grid">
                <div>
                    <h3>Novo Cliente</h3>
                    <div class="input-group">
                        <label>Nome do Cliente</label>
                        <input type="text" id="clienteNome" placeholder="Nome da empresa/cliente">
                    </div>
                    <div class="input-group">
                        <label>Tipo de Servi√ßo</label>
                        <select id="clienteServico">
                            <option value="Social Media">Social Media</option>
                            <option value="Google Ads">Google Ads</option>
                            <option value="Facebook Ads">Facebook/Instagram Ads</option>
                            <option value="Branding">Branding</option>
                            <option value="Website">Website/E-commerce</option>
                            <option value="Consultoria">Consultoria</option>
                            <option value="Pacote Completo">Pacote Completo</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Valor Mensal (R$)</label>
                        <input type="number" id="clienteValor" placeholder="0,00" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>Status</label>
                        <select id="clienteStatus">
                            <option value="Ativo">Ativo</option>
                            <option value="Pausado">Pausado</option>
                            <option value="Cancelado">Cancelado</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Observa√ß√µes</label>
                        <textarea id="clienteObs" placeholder="Detalhes do projeto, necessidades espec√≠ficas..." rows="3"></textarea>
                    </div>
                    <button class="btn" onclick="adicionarCliente()" id="addClienteBtn" disabled>üíæ Adicionar Cliente</button>
                    <div id="clienteSucesso" class="success-message">Cliente adicionado e salvo no Google Sheets!</div>
                    <div id="clienteErro" class="error-message">Erro ao salvar cliente. Verifique a conex√£o.</div>
                </div>

                <div>
                    <h3>Resumo de Clientes</h3>
                    <div class="summary-box">
                        <h3 id="receitaMensal">R$ 0,00</h3>
                        <p>Receita Mensal Total</p>
                    </div>
                    
                    <div class="grid">
                        <div class="metric">
                            <div class="metric-value" id="clientesAtivos">0</div>
                            <div class="metric-label">Clientes Ativos</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="ticketMedio">R$ 0</div>
                            <div class="metric-label">Ticket M√©dio</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="listaClientes">
                <h3>Clientes Cadastrados</h3>
                <p style="color: #b8c6db;">Fa√ßa login com Google para ver os dados.</p>
            </div>
        </div>
    </div>

    <!-- ABA INVESTIMENTOS -->
    <div id="investimentos" class="tab-content">
        <div class="card">
            <h2>üìà Planejamento de Investimentos</h2>
            
            <div class="grid">
                <div>
                    <h3>Novo Investimento</h3>
                    <div class="input-group">
                        <label>√Årea de Investimento</label>
                        <select id="investimentoArea">
                            <option value="Tecnologia">Tecnologia/Software</option>
                            <option value="Equipe">Expans√£o da Equipe</option>
                            <option value="Marketing">Marketing/Vendas</option>
                            <option value="Infraestrutura">Infraestrutura</option>
                            <option value="Capacita√ß√£o">Capacita√ß√£o</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Descri√ß√£o</label>
                        <input type="text" id="investimentoDescricao" placeholder="Ex: Contratar designer senior">
                    </div>
                    <div class="input-group">
                        <label>Valor Estimado (R$)</label>
                        <input type="number" id="investimentoValor" placeholder="0,00" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>Prioridade</label>
                        <select id="investimentoPrioridade">
                            <option value="Alta">Alta</option>
                            <option value="M√©dia">M√©dia</option>
                            <option value="Baixa">Baixa</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>ROI Esperado (%)</label>
                        <input type="number" id="investimentoROI" placeholder="0" step="1">
                    </div>
                    <button class="btn" onclick="adicionarInvestimento()" id="addInvestimentoBtn" disabled>üíæ Adicionar Investimento</button>
                    <div id="investimentoSucesso" class="success-message">Investimento adicionado e salvo no Google Sheets!</div>
                    <div id="investimentoErro" class="error-message">Erro ao salvar investimento. Verifique a conex√£o.</div>
                </div>

                <div>
                    <h3>Resumo de Investimentos</h3>
                    <div class="summary-box">
                        <h3 id="totalInvestimentos">R$ 0,00</h3>
                        <p>Total Planejado</p>
                    </div>
                    
                    <div class="grid">
                        <div class="metric">
                            <div class="metric-value" id="investimentosAlta">0</div>
                            <div class="metric-label">Alta Prioridade</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="roiMedio">0%</div>
                            <div class="metric-label">ROI M√©dio</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="listaInvestimentos">
                <h3>Investimentos Planejados</h3>
                <p style="color: #b8c6db;">Fa√ßa login com Google para ver os dados.</p>
            </div>
        </div>
    </div>

    <!-- ABA DASHBOARD -->
    <div id="dashboard" class="tab-content">
        <div class="card">
            <h2>üìä Dashboard Executivo</h2>
            
            <div class="grid">
                <div class="metric">
                    <div class="metric-value" id="dashReceita">R$ 0</div>
                    <div class="metric-label">Receita Mensal</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="dashGastos">R$ 0</div>
                    <div class="metric-label">Gastos Mensais</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="dashLucro">R$ 0</div>
                    <div class="metric-label">Lucro L√≠quido</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="dashMargem">0%</div>
                    <div class="metric-label">Margem de Lucro</div>
                </div>
            </div>

            <div class="grid">
                <div>
                    <h3>Pr√≥ximos Investimentos Priorit√°rios</h3>
                    <div id="proximosInvestimentos">
                        <p style="color: #b8c6db;">Fa√ßa login e carregue os dados para ver.</p>
                    </div>
                </div>
                <div>
                    <h3>Alertas e Recomenda√ß√µes</h3>
                    <div id="alertas">
                        <div class="expense-item">
                            <strong>üîê OAuth Ativo:</strong> Sistema conectado de forma segura.
                        </div>
                        <div class="expense-item">
                            <strong>üìà Crescimento:</strong> Use os dados para tomar decis√µes estrat√©gicas.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ABA AJUDA -->
    <div id="ajuda" class="tab-content">
        <div class="card">
            <h2>‚ùì Como Usar o Sistema OAuth</h2>
            
            <div style="line-height: 1.8;">
                <h3>üîê Passo 1: Login com Google</h3>
                <p>1. Clique em "üîê Fazer Login com Google"</p>
                <p>2. Escolha sua conta Google</p>
                <p>3. Autorize o acesso √†s planilhas</p>
                
                <h3>üìä Passo 2: Configurar Planilha</h3>
                <p>1. Sua planilha j√° est√° configurada no sistema</p>
                <p>2. Clique "üß™ Verificar Planilha" para testar</p>
                <p>3. Clique "üì• Carregar Dados" para importar</p>
                
                <h3>‚úÖ Passo 3: Usar o Sistema</h3>
                <p>1. Navegue pelas abas (Gastos, Clientes, Investimentos)</p>
                <p>2. Adicione novos dados nos formul√°rios</p>
                <p>3. Visualize relat√≥rios no Dashboard</p>
                
                <h3>üìã Headers das Abas na Planilha</h3>
                <div class="expense-item">
                    <strong>Aba "Gastos":</strong><br>
                    Data | Descri√ß√£o | Categoria | Valor | Recorr√™ncia
                </div>
                <div class="expense-item">
                    <strong>Aba "Clientes":</strong><br>
                    Data | Nome | Servi√ßo | Valor | Status | Observa√ß√µes
                </div>
                <div class="expense-item">
                    <strong>Aba "Investimentos":</strong><br>
                    Data | √Årea | Descri√ß√£o | Valor | Prioridade | ROI
                </div>

                <h3>üöÄ Vantagens do OAuth</h3>
                <div class="expense-item">
                    <strong>‚úÖ Sem CORS:</strong> Acesso direto √†s APIs do Google<br>
                    <strong>‚úÖ Sem 404:</strong> Autentica√ß√£o completa e segura<br>
                    <strong>‚úÖ Sem limites:</strong> Acesso total √†s suas planilhas<br>
                    <strong>‚úÖ Seguro:</strong> Padr√£o oficial do Google
                </div>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // CONFIGURA√á√ïES GOOGLE OAUTH
        // =============================================
        
        const CLIENT_ID = '100762703811-olhq6oq8g6ictgc72734o83o340e42id.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyBcBrOkeLCMIJOE6JTQE3QUX7aOsKf3PQc'; // Voc√™ pode adicionar sua API Key aqui se quiser
        const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';
        const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';

        let gapi;
        let isSignedIn = false;
        let spreadsheetId = '1ybPKiw96ah1ufGXWh853Y0HdK0TEmztvZxg5W8dh2fQ';

        // Dados locais
        let gastos = [];
        let investimentos = [];
        let clientes = [];

        // =============================================
        // FUN√á√ïES DE INICIALIZA√á√ÉO GOOGLE API
        // =============================================

        function initClient() {
            // Esta fun√ß√£o √© chamada automaticamente quando a API carrega
            gapi.load('client:auth2', initializeGapi);
        }

        async function initializeGapi() {
            try {
                await gapi.client.init({
                    apiKey: API_KEY,
                    clientId: CLIENT_ID,
                    discoveryDocs: [DISCOVERY_DOC],
                    scope: SCOPES
                });

                console.log('Google API inicializada com sucesso');
                
                // Configurar listeners
                const authInstance = gapi.auth2.getAuthInstance();
                authInstance.isSignedIn.listen(updateSigninStatus);
                
                // Verificar status inicial
                updateSigninStatus(authInstance.isSignedIn.get());
                
                // Habilitar bot√µes
                document.getElementById('signInBtn').disabled = false;
                
                mostrarMensagem('success', '‚úÖ Google API inicializada! Voc√™ pode fazer login agora.');
                
            } catch (error) {
                console.error('Erro ao inicializar Google API:', error);
                mostrarMensagem('error', `‚ùå Erro ao inicializar API: ${error.error || error.message || 'Erro desconhecido'}`);
            }
        }

        function handleAuthClick() {
            gapi.auth2.getAuthInstance().signIn();
        }

        function handleSignoutClick() {
            gapi.auth2.getAuthInstance().signOut();
        }

        function updateSigninStatus(isSignedInParam) {
            isSignedIn = isSignedInParam;
            
            if (isSignedIn) {
                // Usu√°rio autenticado
                const profile = gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile();
                
                // Atualizar interface
                document.getElementById('signInBtn').disabled = true;
                document.getElementById('signOutBtn').disabled = false;
                document.getElementById('verifyBtn').disabled = false;
                
                // Habilitar abas
                document.getElementById('tabGastos').disabled = false;
                document.getElementById('tabInvestimentos').disabled = false;
                document.getElementById('tabClientes').disabled = false;
                document.getElementById('tabDashboard').disabled = false;
                
                // Habilitar bot√µes de adicionar
                document.getElementById('addGastoBtn').disabled = false;
                document.getElementById('addClienteBtn').disabled = false;
                document.getElementById('addInvestimentoBtn').disabled = false;
                
                // Mostrar informa√ß√µes do usu√°rio
                const userInfo = document.getElementById('userInfo');
                const userDetails = document.getElementById('userDetails');
                
                userDetails.innerHTML = `
                    <img src="${profile.getImageUrl()}" class="user-avatar" alt="Avatar">
                    <strong>${profile.getName()}</strong><br>
                    <small style="color: #b8c6db;">${profile.getEmail()}</small>
                `;
                userInfo.style.display = 'block';
                
                atualizarStatusConexao('authenticated', `Autenticado: ${profile.getGivenName()}`);
                mostrarMensagem('success', `‚úÖ Login realizado com sucesso! Bem-vindo, ${profile.getGivenName()}!`);
                
                // Verificar planilha automaticamente
                setTimeout(verificarPlanilha, 1000);
                
            } else {
                // Usu√°rio n√£o autenticado
                document.getElementById('signInBtn').disabled = false;
                document.getElementById('signOutBtn').disabled = true;
                document.getElementById('verifyBtn').disabled = true;
                document.getElementById('loadBtn').disabled = true;
                
                // Desabilitar bot√µes de adicionar
                document.getElementById('addGastoBtn').disabled = true;
                document.getElementById('addClienteBtn').disabled = true;
                document.getElementById('addInvestimentoBtn').disabled = true;
                
                // Desabilitar abas
                document.getElementById('tabGastos').disabled = true;
                document.getElementById('tabInvestimentos').disabled = true;
                document.getElementById('tabClientes').disabled = true;
                document.getElementById('tabDashboard').disabled = true;
                
                // Ocultar informa√ß√µes do usu√°rio
                document.getElementById('userInfo').style.display = 'none';
                
                atualizarStatusConexao('disconnected', 'N√£o Autenticado');
            }
        }

        // =============================================
        // FUN√á√ïES DE GOOGLE SHEETS VIA GAPI
        // =============================================

        async function verificarPlanilha() {
            if (!isSignedIn) {
                mostrarMensagem('error', '‚ùå Fa√ßa login primeiro!');
                return;
            }

            try {
                mostrarMensagem('info', 'üß™ Verificando acesso √† planilha...');
                
                const response = await gapi.client.sheets.spreadsheets.get({
                    spreadsheetId: spreadsheetId
                });

                const planilha = response.result;
                const abas = planilha.sheets.map(sheet => sheet.properties.title);
                
                mostrarMensagem('success', `‚úÖ Planilha acess√≠vel: "${planilha.properties.title}"<br>Abas encontradas: ${abas.join(', ')}`);
                
                // Habilitar bot√£o de carregar
                document.getElementById('loadBtn').disabled = false;
                
                atualizarStatusConexao('connected', 'Planilha Conectada');
                
            } catch (error) {
                console.error('Erro ao verificar planilha:', error);
                mostrarMensagem('error', `‚ùå Erro ao acessar planilha: ${error.result?.error?.message || error.message}`);
            }
        }

        async function lerDadosSheet(nomeAba, range = 'A2:Z1000') {
            try {
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: spreadsheetId,
                    range: `${nomeAba}!${range}`
                });

                return response.result.values || [];
            } catch (error) {
                console.error(`Erro ao ler aba ${nomeAba}:`, error);
                throw error;
            }
        }

        async function adicionarLinhaSheet(nomeAba, dados) {
            try {
                const response = await gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: spreadsheetId,
                    range: `${nomeAba}!A:Z`,
                    valueInputOption: 'RAW',
                    resource: {
                        values: [dados]
                    }
                });

                return response.result;
            } catch (error) {
                console.error(`Erro ao adicionar dados na aba ${nomeAba}:`, error);
                throw error;
            }
        }

        // =============================================
        // FUN√á√ïES DE DADOS
        // =============================================

        async function carregarDados() {
            if (!isSignedIn) {
                mostrarMensagem('error', '‚ùå Fa√ßa login primeiro!');
                return;
            }

            try {
                mostrarMensagem('info', 'üì• Carregando todos os dados...');
                
                // Carregar gastos
                await carregarGastos();
                // Carregar clientes
                await carregarClientes();
                // Carregar investimentos
                await carregarInvestimentos();
                
                mostrarMensagem('success', `‚úÖ Dados carregados com sucesso!<br>Gastos: ${gastos.length} | Clientes: ${clientes.length} | Investimentos: ${investimentos.length}`);
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                mostrarMensagem('error', '‚ùå Erro ao carregar dados da planilha.');
            }
        }

        async function carregarGastos() {
            try {
                const dados = await lerDadosSheet('Gastos');
                gastos = dados.map((row, index) => ({
                    id: index,
                    data: row[0] || '',
                    descricao: row[1] || '',
                    categoria: row[2] || '',
                    valor: parseFloat(row[3]) || 0,
                    recorrencia: row[4] || ''
                })).filter(gasto => gasto.descricao);
                
                atualizarListaGastos();
                atualizarResumoGastos();
            } catch (error) {
                console.error('Erro ao carregar gastos:', error);
            }
        }

        async function carregarClientes() {
            try {
                const dados = await lerDadosSheet('Clientes');
                clientes = dados.map((row, index) => ({
                    id: index,
                    data: row[0] || '',
                    nome: row[1] || '',
                    servico: row[2] || '',
                    valor: parseFloat(row[3]) || 0,
                    status: row[4] || '',
                    obs: row[5] || ''
                })).filter(cliente => cliente.nome);
                
                atualizarListaClientes();
                atualizarResumoClientes();
            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
            }
        }

        async function carregarInvestimentos() {
            try {
                const dados = await lerDadosSheet('Investimentos');
                investimentos = dados.map((row, index) => ({
                    id: index,
                    data: row[0] || '',
                    area: row[1] || '',
                    descricao: row[2] || '',
                    valor: parseFloat(row[3]) || 0,
                    prioridade: row[4] || '',
                    roi: parseInt(row[5]) || 0
                })).filter(inv => inv.descricao);
                
                atualizarListaInvestimentos();
                atualizarResumoInvestimentos();
            } catch (error) {
                console.error('Erro ao carregar investimentos:', error);
            }
        }

        // =============================================
        // FUN√á√ïES DE ADI√á√ÉO DE DADOS
        // =============================================

        async function adicionarGasto() {
            const descricao = document.getElementById('gastoDescricao').value.trim();
            const categoria = document.getElementById('gastoCategoria').value;
            const valor = parseFloat(document.getElementById('gastoValor').value);
            const recorrencia = document.getElementById('gastoRecorrencia').value;

            if (!descricao || !valor || valor <= 0) {
                alert('Por favor, preencha a descri√ß√£o e um valor v√°lido!');
                return;
            }

            if (!isSignedIn) {
                mostrarMensagem('error', '‚ùå Fa√ßa login primeiro!');
                return;
            }

            try {
                const data = new Date().toLocaleDateString('pt-BR');
                const dadosGasto = [data, descricao, categoria, valor, recorrencia];
                
                await adicionarLinhaSheet('Gastos', dadosGasto);
                
                // Adicionar aos dados locais
                const gasto = {
                    id: Date.now(),
                    data: data,
                    descricao: descricao,
                    categoria: categoria,
                    valor: valor,
                    recorrencia: recorrencia
                };

                gastos.push(gasto);
                atualizarListaGastos();
                atualizarResumoGastos();
                limparFormularioGasto();
                mostrarMensagem('sucesso', 'gastoSucesso');
            } catch (error) {
                console.error('Erro ao adicionar gasto:', error);
                mostrarMensagem('erro', 'gastoErro');
            }
        }

        async function adicionarCliente() {
            const nome = document.getElementById('clienteNome').value.trim();
            const servico = document.getElementById('clienteServico').value;
            const valor = parseFloat(document.getElementById('clienteValor').value);
            const status = document.getElementById('clienteStatus').value;
            const obs = document.getElementById('clienteObs').value.trim();

            if (!nome || !valor || valor <= 0) {
                alert('Por favor, preencha o nome e um valor v√°lido!');
                return;
            }

            if (!isSignedIn) {
                mostrarMensagem('error', '‚ùå Fa√ßa login primeiro!');
                return;
            }

            try {
                const data = new Date().toLocaleDateString('pt-BR');
                const dadosCliente = [data, nome, servico, valor, status, obs];
                
                await adicionarLinhaSheet('Clientes', dadosCliente);
                
                const cliente = {
                    id: Date.now(),
                    data: data,
                    nome: nome,
                    servico: servico,
                    valor: valor,
                    status: status,
                    obs: obs
                };

                clientes.push(cliente);
                atualizarListaClientes();
                atualizarResumoClientes();
                limparFormularioCliente();
                mostrarMensagem('sucesso', 'clienteSucesso');
            } catch (error) {
                console.error('Erro ao adicionar cliente:', error);
                mostrarMensagem('erro', 'clienteErro');
            }
        }

        async function adicionarInvestimento() {
            const area = document.getElementById('investimentoArea').value;
            const descricao = document.getElementById('investimentoDescricao').value.trim();
            const valor = parseFloat(document.getElementById('investimentoValor').value);
            const prioridade = document.getElementById('investimentoPrioridade').value;
            const roi = parseInt(document.getElementById('investimentoROI').value) || 0;

            if (!descricao || !valor || valor <= 0) {
                alert('Por favor, preencha a descri√ß√£o e um valor v√°lido!');
                return;
            }

            if (!isSignedIn) {
                mostrarMensagem('error', '‚ùå Fa√ßa login primeiro!');
                return;
            }

            try {
                const data = new Date().toLocaleDateString('pt-BR');
                const dadosInvestimento = [data, area, descricao, valor, prioridade, roi];
                
                await adicionarLinhaSheet('Investimentos', dadosInvestimento);
                
                const investimento = {
                    id: Date.now(),
                    data: data,
                    area: area,
                    descricao: descricao,
                    valor: valor,
                    prioridade: prioridade,
                    roi: roi
                };

                investimentos.push(investimento);
                atualizarListaInvestimentos();
                atualizarResumoInvestimentos();
                limparFormularioInvestimento();
                mostrarMensagem('sucesso', 'investimentoSucesso');
            } catch (error) {
                console.error('Erro ao adicionar investimento:', error);
                mostrarMensagem('erro', 'investimentoErro');
            }
        }

        // =============================================
        // FUN√á√ïES DE INTERFACE
        // =============================================

        function mostrarMensagem(tipo, texto) {
            const messagesDiv = document.getElementById('configMessages');
            const className = tipo === 'success' ? 'success-message' : 
                             tipo === 'error' ? 'error-message' : 'info-message';
            
            if (tipo === 'sucesso' || tipo === 'erro') {
                // Para mensagens espec√≠ficas de formul√°rio
                const elemento = document.getElementById(texto);
                if (elemento) {
                    elemento.style.display = 'block';
                    setTimeout(() => {
                        elemento.style.display = 'none';
                    }, 3000);
                }
            } else {
                // Para mensagens gerais
                messagesDiv.innerHTML = `<div class="${className}" style="display: block;">${texto}</div>`;
                
                setTimeout(() => {
                    if (messagesDiv.innerHTML.includes(texto)) {
                        messagesDiv.innerHTML = '';
                    }
                }, 5000);
            }
        }

        function atualizarStatusConexao(status, texto) {
            const statusElement = document.getElementById('connectionStatus');
            statusElement.className = `connection-status status-${status}`;
            
            const icons = {
                'connected': 'üü¢',
                'disconnected': 'üî¥',
                'authenticated': 'üîê'
            };
            
            statusElement.textContent = `${icons[status]} ${texto}`;
        }

        // Fun√ß√£o para alternar abas
        function mostrarAba(nomeAba) {
            const abas = document.querySelectorAll('.tab-content');
            abas.forEach(aba => aba.classList.remove('active'));
            
            const botoes = document.querySelectorAll('.tab-button');
            botoes.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(nomeAba).classList.add('active');
            
            const botoesArray = Array.from(botoes);
            const botaoClicado = botoesArray.find(btn => btn.textContent.includes({
                'gastos': 'Gastos',
                'investimentos': 'Investimentos', 
                'clientes': 'Clientes',
                'dashboard': 'Dashboard',
                'ajuda': 'Ajuda'
            }[nomeAba]));
            
            if (botaoClicado) {
                botaoClicado.classList.add('active');
            }
            
            if (nomeAba === 'dashboard') {
                atualizarDashboard();
            }
        }

        // Fun√ß√µes de atualiza√ß√£o da interface
        function atualizarListaGastos() {
            const lista = document.getElementById('listaGastos');
            
            if (gastos.length === 0) {
                lista.innerHTML = '<h3>Gastos Registrados</h3><p style="color: #b8c6db;">Nenhum gasto cadastrado ainda.</p>';
                return;
            }
            
            let html = '<h3>Gastos Registrados</h3>';
            
            gastos.forEach(gasto => {
                html += `
                    <div class="expense-item">
                        <strong>${gasto.descricao}</strong><br>
                        <span>Categoria: ${gasto.categoria} | Valor: R$ ${gasto.valor.toFixed(2)} | ${gasto.recorrencia}</span><br>
                        <small>Data: ${gasto.data}</small>
                    </div>
                `;
            });
            
            lista.innerHTML = html;
        }

        function atualizarResumoGastos() {
            const total = gastos.reduce((acc, gasto) => acc + gasto.valor, 0);
            document.getElementById('totalGastos').textContent = `R$ ${total.toFixed(2)}`;
            
            const software = gastos.filter(g => g.categoria === 'Software').reduce((acc, g) => acc + g.valor, 0);
            const marketing = gastos.filter(g => g.categoria === 'Marketing').reduce((acc, g) => acc + g.valor, 0);
            
            document.getElementById('gastosSoftware').textContent = `R$ ${software.toFixed(0)}`;
            document.getElementById('gastosMarketing').textContent = `R$ ${marketing.toFixed(0)}`;
        }

        function atualizarListaClientes() {
            const lista = document.getElementById('listaClientes');
            
            if (clientes.length === 0) {
                lista.innerHTML = '<h3>Clientes Cadastrados</h3><p style="color: #b8c6db;">Nenhum cliente cadastrado ainda.</p>';
                return;
            }
            
            let html = '<h3>Clientes Cadastrados</h3>';
            
            clientes.forEach(cliente => {
                html += `
                    <div class="client-plan">
                        <strong style="font-size: 1.2em;">${cliente.nome}</strong><br>
                        <span>Servi√ßo: ${cliente.servico} | Valor: R$ ${cliente.valor.toFixed(2)}/m√™s</span><br>
                        <span><span class="status-indicator status-${cliente.status.toLowerCase()}"></span>Status: ${cliente.status.toUpperCase()}</span><br>
                        ${cliente.obs ? `<small style="color: #b8c6db;">Obs: ${cliente.obs}</small><br>` : ''}
                        <small>Data: ${cliente.data}</small>
                    </div>
                `;
            });
            
            lista.innerHTML = html;
        }

        function atualizarResumoClientes() {
            const clientesAtivos = clientes.filter(c => c.status === 'Ativo');
            const receita = clientesAtivos.reduce((acc, c) => acc + c.valor, 0);
            const ticketMedio = clientesAtivos.length > 0 ? receita / clientesAtivos.length : 0;
            
            document.getElementById('receitaMensal').textContent = `R$ ${receita.toFixed(2)}`;
            document.getElementById('clientesAtivos').textContent = clientesAtivos.length;
            document.getElementById('ticketMedio').textContent = `R$ ${ticketMedio.toFixed(0)}`;
        }

        function atualizarListaInvestimentos() {
            const lista = document.getElementById('listaInvestimentos');
            
            if (investimentos.length === 0) {
                lista.innerHTML = '<h3>Investimentos Planejados</h3><p style="color: #b8c6db;">Nenhum investimento cadastrado ainda.</p>';
                return;
            }
            
            let html = '<h3>Investimentos Planejados</h3>';
            
            investimentos.forEach(inv => {
                const prioridadeColor = inv.prioridade === 'Alta' ? '#ff6b35' : inv.prioridade === 'M√©dia' ? '#f7931e' : '#4CAF50';
                html += `
                    <div class="investment-item" style="border-left-color: ${prioridadeColor};">
                        <strong>${inv.descricao}</strong><br>
                        <span>√Årea: ${inv.area} | Valor: R$ ${inv.valor.toFixed(2)} | ROI: ${inv.roi}%</span><br>
                        <span style="color: ${prioridadeColor};">Prioridade: ${inv.prioridade.toUpperCase()}</span><br>
                        <small>Data: ${inv.data}</small>
                    </div>
                `;
            });
            
            lista.innerHTML = html;
        }

        function atualizarResumoInvestimentos() {
            const total = investimentos.reduce((acc, inv) => acc + inv.valor, 0);
            document.getElementById('totalInvestimentos').textContent = `R$ ${total.toFixed(2)}`;
            
            const alta = investimentos.filter(i => i.prioridade === 'Alta').length;
            const roiMedio = investimentos.length > 0 ? 
                investimentos.reduce((acc, i) => acc + i.roi, 0) / investimentos.length : 0;
            
            document.getElementById('investimentosAlta').textContent = alta;
            document.getElementById('roiMedio').textContent = `${roiMedio.toFixed(0)}%`;
        }

        function atualizarDashboard() {
            const clientesAtivos = clientes.filter(c => c.status === 'Ativo');
            const receita = clientesAtivos.reduce((acc, c) => acc + c.valor, 0);
            const gastosMensais = gastos.reduce((acc, g) => acc + g.valor, 0);
            const lucro = receita - gastosMensais;
            const margem = receita > 0 ? (lucro / receita) * 100 : 0;

            document.getElementById('dashReceita').textContent = `R$ ${receita.toFixed(0)}`;
            document.getElementById('dashGastos').textContent = `R$ ${gastosMensais.toFixed(0)}`;
            document.getElementById('dashLucro').textContent = `R$ ${lucro.toFixed(0)}`;
            document.getElementById('dashMargem').textContent = `${margem.toFixed(1)}%`;

            const investimentosAlta = investimentos
                .filter(i => i.prioridade === 'Alta')
                .sort((a, b) => b.roi - a.roi)
                .slice(0, 3);

            let htmlInv = '';
            investimentosAlta.forEach(inv => {
                htmlInv += `
                    <div class="expense-item">
                        <strong>${inv.descricao}</strong><br>
                        <span>R$ ${inv.valor.toFixed(2)} | ROI: ${inv.roi}%</span>
                    </div>
                `;
            });
            
            if (htmlInv === '') {
                htmlInv = '<p style="color: #b8c6db;">Carregue os dados para ver investimentos priorit√°rios.</p>';
            }

            document.getElementById('proximosInvestimentos').innerHTML = htmlInv;
        }

        function limparFormularioGasto() {
            document.getElementById('gastoDescricao').value = '';
            document.getElementById('gastoValor').value = '';
        }

        function limparFormularioCliente() {
            document.getElementById('clienteNome').value = '';
            document.getElementById('clienteValor').value = '';
            document.getElementById('clienteObs').value = '';
        }

        function limparFormularioInvestimento() {
            document.getElementById('investimentoDescricao').value = '';
            document.getElementById('investimentoValor').value = '';
            document.getElementById('investimentoROI').value = '';
        }

        // Inicializar quando carregar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîê Sistema Savann com OAuth carregado!');
            atualizarStatusConexao('disconnected', 'Aguardando Login');
        });
    </script>
</body>
</html>
